
{% template no_user %}
  <div class="layout layout--col gap--medium">
    <div class="item">
      <div class="meta"></div>
      <div class="content text--center">
        <span class="value value--medium">No User ID</span>
        <span class="label">Enter a Twitch User ID in plugin settings</span>
      </div>
    </div>
  </div>
{% endtemplate %}

{% template title_bar %}
  <div class="title_bar">

      <svg class="w--8 h--8 binarize" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="none">
        <path fill="#ffffff" d="M13 7.5l-2 2H9l-1.75 1.75V9.5H5V2h8v5.5z"/>
        <g fill="#9146FF">
          <path d="M4.5 1L2 3.5v9h3V15l2.5-2.5h2L14 8V1H4.5zM13 7.5l-2 2H9l-1.75 1.75V9.5H5V2h8v5.5z"/>
          <path d="M11.5 3.75h-1v3h1v-3zM8.75 3.75h-1v3h1v-3z"/>
        </g>
      </svg>
    <span class="title">Twitch Dashboard</span>
    <span class="instance">{{ data.user.display_name }}</span>
  </div>
{% endtemplate %}

{% template dashboard %}

  {% comment %} Size-based class assignments {% endcomment %}
  {% if size == "full" %}
    {% assign avatar_classes = "w--16 h--16 lg:w--20 lg:h--20" %}
    {% assign title_class = "title lg:title" %}
    {% assign viewer_value_class = "value--large lg:value--xlarge" %}
    {% assign stats_value_class = "value--large lg:value--xlarge" %}
    {% assign gap_class = "gap--small lg:gap--medium" %}
    {% assign thumb_width = "320" %}
    {% assign thumb_height = "180" %}
  {% elsif size == "medium" %}
    {% assign avatar_classes = "w--12 h--12 lg:w--16 lg:h--16" %}
    {% assign title_class = "title title--small lg:title" %}
    {% assign viewer_value_class = "value--medium lg:value--large" %}
    {% assign stats_value_class = "value--small lg:value--medium" %}
    {% assign gap_class = "gap--xsmall lg:gap--small" %}
    {% assign thumb_width = "240" %}
    {% assign thumb_height = "135" %}
  {% elsif size == "small" %}
    {% assign avatar_classes = "w--12 h--12 lg:w--14 lg:h--14" %}
    {% assign title_class = "title title--small lg:title" %}
    {% assign viewer_value_class = "value--small lg:value--medium" %}
    {% assign stats_value_class = "value--xsmall lg:value--small" %}
    {% assign gap_class = "gap--xsmall lg:gap--small" %}
    {% assign thumb_width = "240" %}
    {% assign thumb_height = "135" %}
  {% else %}
    {% comment %} tiny {% endcomment %}
    {% assign avatar_classes = "w--10 h--10 lg:w--12 lg:h--12" %}
    {% assign title_class = "title title--small lg:title" %}
    {% assign viewer_value_class = "value--small lg:value--medium" %}
    {% assign stats_value_class = "value--xsmall lg:value--small" %}
    {% assign gap_class = "gap--xsmall lg:gap--small" %}
    {% assign thumb_width = "160" %}
    {% assign thumb_height = "90" %}
  {% endif %}

  {% assign game_icon_svg = '<svg class="w--6 h--6 m--1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 8.5C8 7.948 7.552 7.5 7 7.5S6 7.948 6 8.5V9H5.5C4.948 9 4.5 9.448 4.5 10S4.948 11 5.5 11H6V11.5C6 12.052 6.448 12.5 7 12.5S8 12.052 8 11.5V11H8.5C9.052 11 9.5 10.552 9.5 10S9.052 9 8.5 9H8V8.5Z" fill="#000"/><path d="M18 8C18 8.552 17.552 9 17 9S16 8.552 16 8 16.448 7 17 7 18 7.448 18 8Z" fill="#000"/><path d="M17 13C17.552 13 18 12.552 18 12S17.552 11 17 11 16 11.448 16 12 16.448 13 17 13Z" fill="#000"/><path d="M16 10C16 10.552 15.552 11 15 11S14 10.552 14 10 14.448 9 15 9 16 9.448 16 10Z" fill="#000"/><path d="M19 11C19.552 11 20 10.552 20 10S19.552 9 19 9 18 9.448 18 10 18.448 11 19 11Z" fill="#000"/><path fill-rule="evenodd" clip-rule="evenodd" d="M12 3C10.188 3 7.962 3.258 6.218 3.509C3.943 3.837 2.091 5.517 1.61 7.788C1.341 9.059 1.077 10.562 1.016 11.82C.973 12.723.878 13.983.777 15.192.672 16.45 1.091 17.746 1.861 18.668 2.646 19.609 3.889 20.243 5.324 19.841 6.242 19.584 6.976 18.939 7.52 18.303 8.077 17.652 8.52 16.912 8.835 16.31 9.078 15.847 9.509 15.586 9.915 15.586H14.085C14.491 15.586 14.922 15.847 15.165 16.31 15.48 16.912 15.923 17.652 16.48 18.303 17.024 18.939 17.758 19.584 18.676 19.841 20.111 20.243 21.354 19.609 22.139 18.668 22.908 17.746 23.328 16.45 23.223 15.192 23.122 13.983 23.027 12.723 22.984 11.82 22.923 10.562 22.659 9.059 22.39 7.788 21.909 5.517 20.057 3.837 17.782 3.509 16.038 3.258 13.812 3 12 3ZM6.503 5.489C8.227 5.241 10.337 5 12 5S15.773 5.241 17.497 5.489C18.965 5.7 20.131 6.775 20.433 8.203 20.697 9.446 20.933 10.822 20.986 11.916 21.031 12.856 21.129 14.146 21.23 15.359 21.291 16.096 21.034 16.871 20.604 17.387 20.189 17.884 19.709 18.053 19.215 17.915 18.85 17.813 18.433 17.509 17.999 17.002 17.577 16.509 17.214 15.913 16.936 15.382 16.404 14.367 15.348 13.586 14.085 13.586H9.915C8.652 13.586 7.596 14.367 7.064 15.382 6.786 15.913 6.423 16.509 6.001 17.002 5.567 17.509 5.15 17.813 4.785 17.915 4.291 18.053 3.811 17.884 3.396 17.387 2.966 16.871 2.709 16.096 2.77 15.359 2.871 14.146 2.969 12.856 3.014 11.916 3.067 10.822 3.303 9.446 3.567 8.203 3.869 6.775 5.035 5.7 6.503 5.489Z" fill="#000"/></svg>' %}

  <div class="layout layout--stretch">
    {% if size == "small" %}
      {% comment %} ── Half Horizontal: 2-col split (stream left, stats right) ── {% endcomment %}
      <div class="grid grid--cols-2 gap--small">
        <div class="flex flex--col gap--xsmall">
    {% else %}
      <div class="flex flex--col {{ gap_class }}">
    {% endif %}

      {% comment %} ── Profile Row ── {% endcomment %}
      <div class="item" style="align-items:flex-start;">
        <img src="{{ data.user.profile_image_url }}" class="icon image image-dither binarize {{ avatar_classes }}" />
        <div class="content">
          <span class="{{ title_class }}">{{ data.user.display_name | default: "Unknown" }}</span>
          {% if show_description == "yes" %}
            <span class="description" data-clamp="2">{{ data.user.description | default: "No description" }}</span>
          {% endif %}
          {% if data.stream and data.stream.type == "live" %}
            <span class="label label--inverted mt--1">LIVE</span>
          {% else %}
            <span class="label mt--1">Offline</span>
          {% endif %}
        </div>
      </div>

      <div class="divider h--1 h--max-1"></div>

      {% comment %} ── Stream Section ── {% endcomment %}
      {% if size != "tiny" %}
        {% if data.stream and data.stream.type == "live" %}

          {% if show_thumbnail == "yes" and size == "full" and data.stream.thumbnail_url %}
            {% comment %} Full: thumbnail beside stream info {% endcomment %}
            {% assign thumb = data.stream.thumbnail_url | replace: '{width}', thumb_width | replace: '{height}', thumb_height %}
            <div class="columns columns--2 {{ gap_class }}">
              <div class="flex flex--col gap--xsmall">
          {% else %}
              <div class="item">
                <div class="meta"></div>
                <div class="content">
          {% endif %}

                  <span class="label" data-clamp="2">{{ data.stream.title | default: "No title" }}</span>

                  <span class="label">{{ game_icon_svg }} {{ data.stream.game_name | default: "Unknown" }}</span>

                  {% if show_duration == "yes" %}
                    {% assign started_at = data.stream.started_at | date: "%s" %}
                    {% assign now = "now" | date: "%s" %}
                    {% assign duration_seconds = now | minus: started_at %}
                    {% assign hours = duration_seconds | divided_by: 3600 %}
                    {% assign minutes = duration_seconds | modulo: 3600 | divided_by: 60 %}
                    <span class="label label--outline">
                      {% if hours > 0 %}{{ hours }}h {{ minutes }}m{% else %}{{ minutes }}m{% endif %}
                    </span>
                  {% endif %}

                  {% if show_tags == "yes" and data.stream.tags and data.stream.tags.size > 0 %}
                    <div class="flex flex--row gap--xsmall" style="flex-wrap: wrap;">
                      {% for tag in data.stream.tags limit:4 %}
                        <span class="label label--outline label--small">#{{ tag }}</span>
                      {% endfor %}
                      {% if data.stream.tags.size > 4 %}
                        <span class="label label--outline label--small">+{{ data.stream.tags.size | minus: 4 }}</span>
                      {% endif %}
                    </div>
                  {% endif %}

                  <span class="value {{ viewer_value_class }} value--tnums" data-value-fit="true" data-value-format="true">{{ data.stream.viewer_count | default: "0" }} <span class="label label--small">viewers</span></span>

          {% if show_thumbnail == "yes" and size == "full" and data.stream.thumbnail_url %}
              </div>
              <div class="aspect--16/9">
                <img src="{{ thumb }}" class="image rounded h--full" alt="Stream">
              </div>
            </div>
          {% else %}
                </div>
              </div>
          {% endif %}

          {% comment %} Medium: thumbnail below stream info, constrained width {% endcomment %}
          {% if show_thumbnail == "yes" and size == "medium" and data.stream.thumbnail_url %}
            {% assign thumb = data.stream.thumbnail_url | replace: '{width}', thumb_width | replace: '{height}', thumb_height %}
            <div class="divider h--1 h--max-1"></div>
            <img src="{{ thumb }}" class="image rounded w--48" alt="Stream">
          {% endif %}

          {% comment %} Small: small thumbnail below stream info {% endcomment %}
          {% if show_thumbnail == "yes" and size == "small" and data.stream.thumbnail_url %}
            {% assign thumb = data.stream.thumbnail_url | replace: '{width}', '160' | replace: '{height}', '90' %}
            <img src="{{ thumb }}" class="image rounded w--32" alt="Stream">
          {% endif %}

        {% else %}
          {% comment %} ── Offline Section ── {% endcomment %}
          <div class="item">
            <div class="meta"></div>
            <div class="content">
              {% if data.stream.game_name %}
                <span class="label">Last playing: {{ data.stream.game_name }}</span>
                {% if data.stream.title %}
                  <span class="description" data-clamp="2">{{ data.stream.title }}</span>
                {% endif %}
              {% else %}
                <span class="label">Currently not streaming</span>
              {% endif %}
            </div>
          </div>
        {% endif %}

      {% else %}
        {% comment %} ── Tiny: minimal stream info ── {% endcomment %}
        {% if data.stream and data.stream.type == "live" %}
          <span class="value {{ viewer_value_class }} value--tnums" data-value-fit="true" data-value-format="true">{{ data.stream.viewer_count | default: "0" }} <span class="label label--small">viewers</span></span>
          <span class="label">{{ game_icon_svg }} {{ data.stream.game_name | default: "Unknown" }}</span>
        {% else %}
          {% if data.stream.game_name %}
            <span class="label">Last: {{ data.stream.game_name }}</span>
          {% else %}
            <span class="label">Not streaming</span>
          {% endif %}
        {% endif %}
      {% endif %}

      {% comment %} ── Stats Section ── {% endcomment %}
      {% if show_stats == "yes" %}
        {% if size == "small" %}
          {% comment %} Half Horizontal: close left column, open right column {% endcomment %}
          </div>
          <div class="flex flex--col gap--xsmall">
        {% else %}
          <div class="divider h--1 h--max-1"></div>
        {% endif %}

        <div class="grid grid--cols-3 {{ gap_class }}" style="align-items:flex-start;">
          <div class="item">
            <div class="meta"></div>
            <div class="content text--center">
              <span class="value {{ stats_value_class }} value--tnums" data-value-fit="true" data-value-format="true" data-value-locale="en-US">{{ data.followers.total | default: "0" }}</span>
              <span class="label label--small">Followers</span>
              {% if show_recent_names == "yes" and data.followers.recent and data.followers.recent[0] %}
                <span class="label label--underline">{{ data.followers.recent[0].user_name }}</span>
              {% endif %}
            </div>
          </div>
          {% if data.subscribers.total > 0 %}
          <div class="item">
            <div class="meta"></div>
            <div class="content text--center">
              <span class="value {{ stats_value_class }} value--tnums" data-value-fit="true" data-value-format="true" data-value-locale="en-US">{{ data.subscribers.total | default: "0" }}</span>
              <span class="label label--small">Subs</span>
              {% if show_recent_names == "yes" and data.subscribers.recent and data.subscribers.recent[0] %}
                <span class="label label--underline">{{ data.subscribers.recent[0].user_name }}</span>
              {% endif %}
            </div>
          </div>
          {% endif %}
          {% if data.chatters.total > 0 %}
          <div class="item">
            <div class="meta"></div>
            <div class="content text--center">
              <span class="value {{ stats_value_class }} value--tnums" data-value-fit="true" data-value-format="true" data-value-locale="en-US">{{ data.chatters.total | default: "0" }}</span>
              <span class="label label--small">Chatters</span>
            </div>
          </div>
          {% endif %}
        </div>
      {% endif %}

    {% if size == "small" %}
        </div>
      </div>
    {% else %}
      </div>
    {% endif %}
  </div>
{% endtemplate %}
